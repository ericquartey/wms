
steps:

- script: 'dotnet ef database update --verbose --context BuildDatabaseContext'
  workingDirectory: Common/EF
  failOnStderr: true
  displayName: 'dotnet ef database update'
  continueOnError: true
  env:
    NETCORE_ENVIRONMENT: CloudBuild
    cloudInitialCatalog: '$(CloudInitialCatalog)'

- task: andrewlackenby.sql-toolkit.runsinglesqlscript.RunSingleSqlScript@2
  displayName: 'Apply db seed'
  inputs:
    sqlScript: Common/EF/Seeds/Dev.InitDb.sql
    serverName: 'rd-ferrettogroup.database.windows.net'
    databaseName: '$(CloudInitialCatalog)'
    userName: admin_rd_ferrettogroup
    userPassword: Ferretto2019!
    queryTimeout: 30

- script: 'dotnet ef database drop --verbose --force --context BuildDatabaseContext'
  workingDirectory: Common/EF
  failOnStderr: true
  displayName: 'dotnet ef database drop'
  continueOnError: true
  env:
    NETCORE_ENVIRONMENT: CloudBuild
    cloudInitialCatalog: '$(CloudInitialCatalog)'
