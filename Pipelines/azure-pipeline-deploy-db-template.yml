
steps:

- script: 'dotnet ef database update --verbose --context BuildDatabaseContext'
  workingDirectory: Common/EF
  failOnStderr: true
  displayName: 'dotnet ef database update'
  continueOnError: true
  env:
    NETCORE_ENVIRONMENT: CloudBuild
    buildNumber: '$(Build.BuildId)'

- script: 'sqlcmd -S rd-ferrettogroup.database.windows.net -d Ferretto_WmsDb_%buildDefinitionName%_%buildNumber% -i Dev.Minimal.sql -U admin_rd_ferrettogroup -P Ferretto2019!'
  workingDirectory: Common/EF/Seeds
  failOnStderr: true
  displayName: 'Apply db seed'
  continueOnError: false
  env:
    NETCORE_ENVIRONMENT: CloudBuild
    buildNumber: '$(Build.BuildId)'
    buildDefinitionName: '$(Build.DefinitionName)'

- script: 'dotnet ef database drop --verbose --force --context BuildDatabaseContext'
  workingDirectory: Common/EF
  failOnStderr: true
  displayName: 'dotnet ef database drop'
  continueOnError: true
  env:
    NETCORE_ENVIRONMENT: CloudBuild
    buildNumber: '$(Build.BuildId)'
