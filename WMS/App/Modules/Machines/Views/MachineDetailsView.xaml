<wms:WmsView x:Class="Ferretto.WMS.Modules.Machines.MachineDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dxa="http://schemas.devexpress.com/winfx/2008/xaml/accordion"
             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:models="clr-namespace:Ferretto.WMS.App.Core.Models;assembly=Ferretto.WMS.App.Core"
             xmlns:res="clr-namespace:Ferretto.Common.Resources;assembly=Ferretto.Common.Resources"
             xmlns:wms="clr-namespace:Ferretto.WMS.App.Controls;assembly=Ferretto.WMS.App.Controls"
             Title="{x:Static res:Navigation.MachineDetails}"
             MinHeight="300"
             d:DesignHeight="450"
             d:DesignWidth="800"
             EnableHistoryView="True"
             SubTitle="{Binding Model.Nickname, StringFormat={x:Static res:Title.MachineDetailsView}}"
             SubTitleVisibility="{Binding Model, Converter={StaticResource RTVC}}"
             mc:Ignorable="d">

    <Grid HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          IsEnabled="{Binding IsBusy, Converter={StaticResource BNC}}">
        <Grid.Resources>
            <wms:BoolToDoubleConverter x:Key="BTOC"
                                       ValueOnFalse="0.3"
                                       ValueOnTrue="1" />

            <DataTemplate x:Key="cardTemplate">

                <Grid DataContext="{Binding Row}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <wms:InfoText Grid.ColumnSpan="2"
                                  MaxHeight="60"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding Description}" />
                    <StackPanel Grid.Row="1"
                                Margin="0,2,12,10"
                                VerticalAlignment="Top"
                                Orientation="Vertical">
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding BayTypeId}" />
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding LoadingUnitsBufferSize}" />
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding Priority}" />
                    </StackPanel>
                    <StackPanel Grid.Row="1"
                                Grid.Column="1"
                                Margin="12,-15,12,10"
                                VerticalAlignment="Top"
                                Orientation="Vertical">
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding IsActive}" />
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding UserLogged}" />
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding LoadingUnitInBayDescription}" />
                    </StackPanel>

                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="cardHeaderTemplate">
                <Border Background="{DynamicResource CommonSecondaryUltralight}">
                    <Grid Margin="11,3">
                        <TextBlock VerticalAlignment="Center"
                                   FontSize="20"
                                   Text="{Binding Path=RowData.Row.Description}" />
                    </Grid>
                </Border>
            </DataTemplate>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto"
                              MaxWidth="400" />
        </Grid.ColumnDefinitions>

        <wms:BusyIndicator Grid.Column="1"
                           Grid.ColumnSpan="3"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsBusy="{Binding IsBusy}" />
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <wms:NotifyControl SubTitleDimension="{Binding SubTitleDimension, RelativeSource={RelativeSource AncestorType={x:Type wms:WmsHistoryView}}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" />

            <wms:ActionBar Grid.Column="1"
                           Grid.ColumnSpan="2"
                           MinWidth="100"
                           Margin="0,10,10,0"
                           HorizontalAlignment="Right"
                           Style="{DynamicResource ActionBarNotCustomizable}">
                <wms:ActionBarItem Command="{Binding RefreshCommand}"
                                   Content="{x:Static res:General.Refresh}"
                                   CustomGlyphSize="24,24"
                                   Glyph="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/material/navigation/1x_web/ic_refresh_black_24dp.png"
                                   GlyphSize="Custom" />
            </wms:ActionBar>

            <TextBlock Grid.Row="1"
                       Grid.ColumnSpan="2"
                       Margin="0,0,10,5"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Top"
                       Style="{DynamicResource TextBlockErrorMessageStyle}"
                       Text="{Binding Model.Error}"
                       TextAlignment="Right"
                       Visibility="{Binding Model.Error, Converter={StaticResource STVC}}" />

        </Grid>

        <ScrollViewer Grid.Row="1"
                      Margin="10,0,10,10"
                      Focusable="False"
                      IsTabStop="True"
                      Visibility="{Binding Model, Converter={StaticResource RTVC}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>


                <!--  info  -->
                <GroupBox Grid.Row="0"
                          Grid.ColumnSpan="2"
                          Header="{x:Static res:Machines.MachineInformation}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.Nickname, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.Model, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.RegistrationNumber, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Column="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.MachineTypeDescription, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="1"
                                      Grid.Column="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.AreaName, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:TextBox Grid.Row="2"
                                     Grid.Column="1"
                                     wms:ShowTitle.Show="True"
                                     EditValue="{Binding Path=Model.UrlService}" />

                        <!--<wms:ComboBox Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      EditValue="{Binding Path=Model.ItemCategoryId, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding Path=Model.ItemCategoryChoices}" />
                            <wms:TextBox Grid.RowSpan="3"
                                     Grid.Column="1"
                                     MaxHeight="155"
                                     Margin="20,0,0,0"
                                     VerticalContentAlignment="Stretch"
                                     wms:ShowTitle.Show="True"
                                     EditValue="{Binding Path=Model.Note, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}"
                                     IsMultiline="True" />-->
                    </Grid>
                </GroupBox>
                <!--  content  -->
                <GroupBox Grid.Column="2"
                          MinWidth="100"
                          MaxWidth="440"
                          Margin="10,0,0,0"
                          Header="{x:Static res:Machines.MachineContent}">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <wms:WmsEnumIndicator AdditionalValue="{Binding Model.ItemCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding ItemObject}"
                                              IconSize="24"
                                              ShowText="True" />
                        <wms:WmsEnumIndicator Grid.Column="1"
                                              AdditionalValue="{Binding Model.LoadingUnitCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding LoadingUnitObject}"
                                              IconSize="24"
                                              ShowText="True" />
                        <wms:WmsEnumIndicator Grid.Column="2"
                                              AdditionalValue="{Binding Model.ItemListCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding ItemListObject}"
                                              IconSize="24"
                                              ShowText="True" />

                        <wms:WmsEnumIndicator Grid.Row="1"
                                              AdditionalValue="{Binding Model.CellCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding CellObject}"
                                              IconSize="24"
                                              ShowText="True" />
                        <wms:WmsEnumIndicator Grid.Row="1"
                                              Grid.Column="1"
                                              AdditionalValue="{Binding Model.CompartmentCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding CompartmentObject}"
                                              IconSize="24"
                                              ShowText="True" />
                        <wms:WmsEnumIndicator Grid.Row="1"
                                              Grid.Column="2"
                                              AdditionalValue="{Binding Model.MissionCount}"
                                              EnumType="{x:Type models:ModelObject}"
                                              EnumValue="{Binding MissionObject}"
                                              IconSize="24"
                                              ShowText="True" />

                    </Grid>

                </GroupBox>

                <!--  statistics  -->
                <GroupBox Grid.Row="1"
                          Grid.ColumnSpan="2"
                          Header="{x:Static res:Machines.MachineStatistics}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Orientation="Vertical">
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.GrossMaxWeight}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.GrossWeight}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.NetMaxWeight}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.NetWeight}" />

                        </StackPanel>
                        <StackPanel Grid.Column="1"
                                    Orientation="Vertical">
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.LastPowerOn}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.PowerOnTime}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.AutomaticTime}" />
                        </StackPanel>
                        <StackPanel Grid.Column="2"
                                    Orientation="Vertical">
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.ManualTime}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.ErrorTime}" />
                            <wms:InfoText wms:ShowTitle.Show="True"
                                          Content="{Binding Model.MissionTime}" />

                        </StackPanel>
                        <StackPanel Grid.Column="3">
                            <wms:ProgressBarEdit Grid.Column="2"
                                                 DisplayFormatString="p0"
                                                 EditValue="{Binding Path=Model.AreaFillRate, Mode=OneWay}"
                                                 Maximum="100"
                                                 Minimum="0" />
                            <wms:ProgressBarEdit Grid.Row="1"
                                                 Grid.Column="2"
                                                 DisplayFormatString="p0"
                                                 EditValue="{Binding Path=Model.WeightFillRate, Mode=OneWay}"
                                                 Maximum="100"
                                                 Minimum="0" />
                        </StackPanel>

                    </Grid>
                </GroupBox>

                <!--  live  -->
                <GroupBox Grid.Row="1"
                          Grid.Column="2"
                          Margin="10,0,0,0"
                          Header="{x:Static res:Machines.MachineLive}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>


                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding MachineLive.Status}"
                                      IsPillVisible="True" />
                        <wms:InfoText Grid.Row="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.FaultCode}"
                                      IsPillVisible="True" />
                        <wms:InfoText Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.CurrentLoadingUnitPosition}" />
                    </Grid>
                </GroupBox>
                <!--  rate  -->

                <!--  bays  -->
                <GroupBox Grid.Row="2"
                          Grid.ColumnSpan="3"
                          Header="{x:Static res:Machines.MachineBays}">
                    <StackPanel Margin="0,10,0,0">
                        <wms:WmsGridControl x:Name="MainGridControl"
                                            Grid.Row="2"
                                            Grid.ColumnSpan="3"
                                            MaxWidth="2000"
                                            MaxHeight="5000"
                                            Margin="3"
                                            CurrentItem="{Binding SelectedBay, Mode=TwoWay}"
                                            ItemsSource="{Binding Model.Bays, Mode=OneWay}"
                                            SelectionMode="Row"
                                            ShowBorder="False">


                            <dxg:GridControl.View>
                                <dxg:CardView AllowCardResizing="false"
                                              AllowEditing="False"
                                              CardHeaderTemplate="{StaticResource cardHeaderTemplate}"
                                              CardLayout="Rows"
                                              CardMargin="0,0,6,6"
                                              CardTemplate="{StaticResource cardTemplate}"
                                              FixedSize="220"
                                              MinFixedSize="150"
                                              NavigationStyle="Row"
                                              PrintAutoCardWidth="False"
                                              SearchPanelHorizontalAlignment="Right"
                                              SeparatorThickness="0"
                                              ShowCardExpandButton="False"
                                              ShowColumnHeaders="False"
                                              ShowFilterPanelMode="Never"
                                              ShowFixedTotalSummary="True"
                                              ShowGroupPanel="False"
                                              ShowGroupedColumns="False"
                                              ShowSearchPanelMode="Never"
                                              ShowSelectionRectangle="False" />

                            </dxg:GridControl.View>

                            <wms:WmsGridControl.Columns>
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="AreaName" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="InstallationDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="LastServiceDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Status" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="MachineTypeDescription" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="MaintenanceStatus" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Model" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="NextServiceDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Nickname" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="RegistrationNumber" />

                            </wms:WmsGridControl.Columns>

                            <wms:WmsGridControl.SortInfo>
                                <dxg:GridSortInfo FieldName="AreaName"
                                                  SortOrder="Ascending" />
                                <dxg:GridSortInfo FieldName="Nickname"
                                                  SortOrder="Ascending" />
                            </wms:WmsGridControl.SortInfo>

                            <wms:WmsGridControl.TotalSummary>
                                <dxg:GridSummaryItem Alignment="Left"
                                                     DisplayFormat="{x:Static res:DesktopApp.GridRowCounter}"
                                                     SummaryType="Count" />
                            </wms:WmsGridControl.TotalSummary>

                        </wms:WmsGridControl>

                    </StackPanel>
                </GroupBox>
            </Grid>
        </ScrollViewer>
        <!--  image  + date  -->
        <ScrollViewer Grid.RowSpan="2"
                      Grid.Column="1"
                      Focusable="False"
                      IsTabStop="False"
                      Visibility="{Binding Model, Converter={StaticResource RTVC}}">

            <Border Style="{StaticResource InfoBoxBorderStyle}"
                    Visibility="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type wms:WmsView}}, Converter={StaticResource BTTVC}, ConverterParameter={StaticResource MinWidthDetailsView}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <GroupBox Margin="20,0"
                              Header="{x:Static res:MasterData.Image}">

                        <wms:WmsImageEdit MaxWidth="300"
                                          MaxHeight="400"
                                          BorderBrush="{DynamicResource CommonSecondaryLight}"
                                          BorderThickness="1"
                                          Filename="{Binding Path=Model.Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          Path="{Binding Path=Model.Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </GroupBox>
                    <!--  Date  -->
                    <GroupBox Grid.Row="1"
                              Margin="20,0"
                              Header="{x:Static res:General.OtherInformation}">
                        <StackPanel Orientation="Vertical">
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.BuildDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.InstallationDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.TestDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.LastServiceDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.NextServiceDate}" />
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </Border>
        </ScrollViewer>


    </Grid>
</wms:WmsView>
