<wms:WmsView x:Class="Ferretto.WMS.Modules.Machines.MachineDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:res="clr-namespace:Ferretto.WMS.App.Resources;assembly=Ferretto.WMS.App.Resources"
             xmlns:wms="clr-namespace:Ferretto.WMS.App.Controls;assembly=Ferretto.WMS.App.Controls"
             Title="{x:Static res:Navigation.MachineDetails}"
             MinHeight="300"
             d:DesignHeight="450"
             d:DesignWidth="800"
             EnableHistoryView="True"
             SubTitle="{Binding Model.Nickname, StringFormat={x:Static res:Title.MachineDetailsView}}"
             SubTitleVisibility="{Binding Model, Converter={StaticResource RTVC}}"
             mc:Ignorable="d">

    <Grid HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          IsEnabled="{Binding IsBusy, Converter={StaticResource BNC}}">
        <Grid.Resources>

            <DataTemplate x:Key="cardTemplate">

                <Grid DataContext="{Binding Row}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <wms:InfoText Grid.Row="1"
                                  Grid.Column="0"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding BayTypeDescription}" />
                    <wms:InfoText Grid.Row="2"
                                  Grid.Column="0"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding LoadingUnitsBufferSize}" />
                    <wms:InfoText Grid.Row="3"
                                  Grid.Column="0"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding Priority}" />
                    <wms:InfoText Grid.Row="1"
                                  Grid.Column="1"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding IsActive}" />
                    <wms:InfoText Grid.Row="2"
                                  Grid.Column="1"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding UserLogged}" />
                    <wms:InfoText Grid.Row="3"
                                  Grid.Column="1"
                                  wms:ShowTitle.Show="True"
                                  Content="{Binding LoadingUnitInBayDescription}" />

                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="cardHeaderTemplate">
                <Border Background="{DynamicResource CommonSecondaryUltralight}">
                    <Grid Margin="11,3">
                        <TextBlock VerticalAlignment="Center"
                                   FontSize="20"
                                   Text="{Binding Path=RowData.Row.Description}" />
                    </Grid>
                </Border>
            </DataTemplate>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto"
                              MaxWidth="400" />
        </Grid.ColumnDefinitions>

        <wms:BusyIndicator Grid.Row="1"
                           Grid.RowSpan="2"
                           Grid.ColumnSpan="2"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsBusy="{Binding IsBusy}" />
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <wms:NotifyControl SubTitleDimension="{Binding SubTitleDimension, RelativeSource={RelativeSource AncestorType={x:Type wms:WmsHistoryView}}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" />

            <wms:ActionBar Grid.Column="1"
                           Grid.ColumnSpan="2"
                           MinWidth="100"
                           Margin="0,10,10,0"
                           HorizontalAlignment="Right"
                           Style="{DynamicResource ActionBarNotCustomizable}">
                <wms:ActionBarItem Command="{Binding RefreshCommand}"
                                   Content="{x:Static res:General.Refresh}"
                                   CustomGlyphSize="24,24"
                                   Glyph="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/material/navigation/1x_web/ic_refresh_black_24dp.png"
                                   GlyphSize="Custom" />
            </wms:ActionBar>

            <TextBlock Grid.Row="1"
                       Grid.ColumnSpan="2"
                       Margin="0,0,10,5"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Top"
                       Style="{DynamicResource TextBlockErrorMessageStyle}"
                       Text="{Binding Model.Error}"
                       TextAlignment="Right"
                       Visibility="{Binding Model.Error, Converter={StaticResource STVC}}" />

        </Grid>

        <ScrollViewer Grid.Row="1"
                      Margin="10,0,10,10"
                      Focusable="False"
                      IsTabStop="True"
                      Visibility="{Binding Model, Converter={StaticResource RTVC}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>


                <!--  info  -->
                <GroupBox Grid.Row="0"
                          Grid.ColumnSpan="2"
                          Header="{x:Static res:Machines.MachineInformation}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.Nickname, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.Model, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.RegistrationNumber, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Column="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.MachineTypeDescription, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:InfoText Grid.Row="1"
                                      Grid.Column="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Path=Model.AreaName, Mode=TwoWay, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" />
                        <wms:TextBox Grid.Row="2"
                                     Grid.Column="1"
                                     wms:ShowTitle.Show="True"
                                     EditValue="{Binding Path=Model.ServiceUrl}" />
                    </Grid>
                </GroupBox>


                <!--  live  -->
                <GroupBox Grid.Column="3"
                          Margin="10,0,0,0"
                          Header="{x:Static res:Machines.MachineLive}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>


                        <wms:InfoText wms:ShowTitle.Show="True"
                                      Content="{Binding MachineLive.Status}"
                                      IsPillVisible="True" />
                        <wms:InfoText Grid.Row="1"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.FaultCode}"
                                      IsPillVisible="True" />
                        <wms:InfoText Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.CurrentLoadingUnitPosition}" />
                    </Grid>
                </GroupBox>


                <!--  statistics  -->
                <GroupBox Grid.Row="1"
                          MinWidth="180"
                          Header="{x:Static res:Machines.MachineStatistics}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <wms:ProgressBarEdit Margin="0,0,5,5"
                                             EditValue="{Binding Model.GrossWeight}"
                                             Maximum="{Binding Model.GrossMaxWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Minimum="0"
                                             TextOut="{Binding Model.GrossMaxWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Type="MinMaxCurrentH" />
                        <wms:ProgressBarEdit Grid.Row="1"
                                             Margin="0,5,5,5"
                                             EditValue="{Binding Model.NetWeight}"
                                             Maximum="{Binding Model.NetMaxWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Minimum="0"
                                             TextOut="{Binding Model.NetMaxWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Type="MinMaxCurrentH" />
                        <wms:InfoText Grid.Row="2"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.LastPowerOn}" />
                        <wms:InfoText Grid.Row="3"
                                      wms:ShowTitle.Show="True"
                                      Content="{Binding Model.PowerOnTime}" />
                    </Grid>
                </GroupBox>

                <!--  rate  -->
                <GroupBox Grid.Row="1"
                          Grid.Column="1"
                          Header="Rate">

                    <Grid VerticalAlignment="Top">
                        <Grid.Resources>
                            <dxmvvm:FormatStringConverter x:Key="FormatStringConverter"
                                                          FormatString=" {0}%" />
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <wms:ProgressBarEdit x:Name="AreaFillRate"
                                             Margin="0,0,5,5"
                                             EditValue="{Binding Path=Model.AreaFillRate, Mode=TwoWay}"
                                             IsPercent="True"
                                             Maximum="100"
                                             Minimum="0"
                                             TextOut="{Binding Path=Model.AreaFillRate, Mode=OneWay, Converter={StaticResource FormatStringConverter}}"
                                             Type="Percent" />
                        <wms:ProgressBarEdit x:Name="WeightFillRate"
                                             Grid.Row="1"
                                             Grid.Column="0"
                                             Margin="0,0,5,5"
                                             EditValue="{Binding Path=MachineLive.WeightFillRate, Mode=TwoWay}"
                                             IsPercent="True"
                                             Maximum="100"
                                             Minimum="0"
                                             TextOut="{Binding Path=MachineLive.WeightFillRate, Mode=OneWay, Converter={StaticResource FormatStringConverter}}"
                                             Type="Percent" />
                    </Grid>
                </GroupBox>


                <!--  time - pie chart  -->
                <GroupBox Grid.Row="1"
                          Grid.Column="2"
                          Grid.ColumnSpan="2">
                    <wms:PieChart Width="500"
                                  Height="250"
                                  Margin="0,-16,0,0" />
                </GroupBox>


                <!--  bays  -->
                <GroupBox Grid.Row="2"
                          Grid.ColumnSpan="4"
                          Header="{x:Static res:Machines.MachineBays}">
                    <StackPanel Margin="0,10,0,0">
                        <wms:WmsGridControl x:Name="MainGridControl"
                                            MaxWidth="2000"
                                            MaxHeight="5000"
                                            Margin="3"
                                            CurrentItem="{Binding SelectedBay, Mode=TwoWay}"
                                            ItemsSource="{Binding Model.Bays, Mode=OneWay}"
                                            SelectionMode="Row"
                                            ShowBorder="False">


                            <dxg:GridControl.View>
                                <dxg:CardView AllowCardResizing="false"
                                              AllowEditing="False"
                                              CardHeaderTemplate="{StaticResource cardHeaderTemplate}"
                                              CardLayout="Rows"
                                              CardMargin="0,0,6,6"
                                              CardTemplate="{StaticResource cardTemplate}"
                                              FixedSize="220"
                                              MinFixedSize="150"
                                              NavigationStyle="Row"
                                              PrintAutoCardWidth="False"
                                              SearchPanelHorizontalAlignment="Right"
                                              SeparatorThickness="0"
                                              ShowCardExpandButton="False"
                                              ShowColumnHeaders="False"
                                              ShowFilterPanelMode="Never"
                                              ShowFixedTotalSummary="False"
                                              ShowGroupPanel="False"
                                              ShowGroupedColumns="False"
                                              ShowSearchPanelMode="Never"
                                              ShowSelectionRectangle="False" />

                            </dxg:GridControl.View>

                            <wms:WmsGridControl.Columns>
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="AreaName" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="InstallationDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="LastServiceDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Status" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="MachineTypeDescription" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="MaintenanceStatus" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Model" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="NextServiceDate" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="Nickname" />
                                <dxg:GridColumn AllowSorting="True"
                                                AllowedBinaryFilters="Equals,DoesNotEqual"
                                                FieldName="RegistrationNumber" />

                            </wms:WmsGridControl.Columns>

                            <wms:WmsGridControl.SortInfo>
                                <dxg:GridSortInfo FieldName="AreaName"
                                                  SortOrder="Ascending" />
                                <dxg:GridSortInfo FieldName="Nickname"
                                                  SortOrder="Ascending" />
                            </wms:WmsGridControl.SortInfo>

                        </wms:WmsGridControl>

                    </StackPanel>
                </GroupBox>


            </Grid>
        </ScrollViewer>
        <!--  image  + date + content  -->
        <ScrollViewer Grid.RowSpan="2"
                      Grid.Column="1"
                      Focusable="False"
                      IsTabStop="False"
                      Visibility="{Binding Model, Converter={StaticResource RTVC}}">

            <Border Style="{StaticResource InfoBoxBorderStyle}"
                    Visibility="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type wms:WmsView}}, Converter={StaticResource BTTVC}, ConverterParameter={StaticResource MinWidthDetailsView}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <GroupBox Margin="20,0"
                              Header="{x:Static res:BusinessObjects.Image}">

                        <wms:WmsImage MaxWidth="200"
                                      MaxHeight="300"
                                      BorderBrush="{DynamicResource CommonSecondaryLight}"
                                      BorderThickness="1"
                                      Path="{Binding Path=Model.Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </GroupBox>
                    <!--  Date  -->
                    <GroupBox Grid.Row="1"
                              Margin="20,0"
                              Header="{x:Static res:General.OtherInformation}">
                        <StackPanel Orientation="Vertical">
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.BuildDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.InstallationDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.TestDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.LastServiceDate}" />
                            <wms:InfoText HorizontalAlignment="Left"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Path=Model.NextServiceDate}" />
                        </StackPanel>
                    </GroupBox>

                    <!--  content  -->
                    <GroupBox Grid.Row="2"
                              MinWidth="100"
                              MaxWidth="440"
                              Margin="20,0"
                              Header="{x:Static res:Machines.MachineContent}">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/ferretto/logistics/icons8-stacking-50.png" />
                            <wms:InfoText Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.ItemCount}" />

                            <Image Grid.Row="1"
                                   Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/Ferretto/Menu/grey/loading_unit.png" />
                            <wms:InfoText Grid.Row="1"
                                          Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.LoadingUnitCount}" />

                            <Image Grid.Row="2"
                                   Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/Material/action/1x_web/ic_list_black_24dp.png" />
                            <wms:InfoText Grid.Row="2"
                                          Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.ItemListCount}" />

                            <Image Grid.Row="3"
                                   Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/ferretto/logistics/icons8-grid-50.png" />
                            <wms:InfoText Grid.Row="3"
                                          Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.CellCount}" />

                            <Image Grid.Row="4"
                                   Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/ferretto/logistics/icons8-view-module-50.png" />
                            <wms:InfoText Grid.Row="4"
                                          Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.CompartmentCount}" />


                            <Image Grid.Row="5"
                                   Width="24"
                                   Height="24"
                                   HorizontalAlignment="Left"
                                   Source="pack://application:,,,/Ferretto.WMS.App.Themes;component/icons/ferretto/logistics/icons8-target-50.png" />
                            <wms:InfoText Grid.Row="5"
                                          Grid.Column="1"
                                          Margin="10,0,0,0"
                                          wms:ShowTitle.Show="True"
                                          Content="{Binding Model.MissionCount}" />

                        </Grid>

                    </GroupBox>

                </Grid>
            </Border>
        </ScrollViewer>


    </Grid>
</wms:WmsView>
